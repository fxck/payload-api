"use strict";(self.webpackChunkpayload_blog_typescript=self.webpackChunkpayload_blog_typescript||[]).push([[977],{6977:(e,l,o)=>{o.r(l),o.d(l,{default:()=>k});var a=o(7294),t=o(899),s=o(1455),r=o(546),n=o(4346),i=o(7578),d=o(5074),c=o(4012),p=o(3864),u=o(8285),m=o(666),v=o(2524),b=o(5050),f=o(8851),w=o(5193),h=o(4945),y=o(8728);o(3739);const E="field-type blocks",g={singular:"Block",plural:"Blocks"},R=a.memo((e=>{const{onDragEnd:l,label:o,showError:s,errorMessage:r,rows:i,labels:d,addRow:c,removeRow:p,moveRow:v,path:w,fieldTypes:g,permissions:R,value:k,setCollapse:x,blocks:C,readOnly:T,minRows:_,maxRows:Z,required:I,description:O}=e,D=Z&&i.length>=Z;return a.createElement(t.Z5,{onDragEnd:l},a.createElement("div",{className:E},a.createElement("div",{className:`${E}__error-wrap`},a.createElement(m.Z,{showError:s,message:r})),a.createElement("header",{className:`${E}__header`},a.createElement("h3",null,o),a.createElement(y.Z,{value:k,description:O})),a.createElement(t.bK,{droppableId:"blocks-drop",isDropDisabled:T},(e=>a.createElement("div",{ref:e.innerRef,...e.droppableProps},i.length>0&&i.map(((e,l)=>{var o;const{blockType:t}=e,s=C.find((e=>e.slug===t));return s?a.createElement(u.Z,{readOnly:T,key:e.id,id:e.id,blockType:"blocks",blocks:C,label:null===(o=null==s?void 0:s.labels)||void 0===o?void 0:o.singular,isCollapsed:e.collapsed,rowCount:i.length,rowIndex:l,addRow:c,removeRow:p,moveRow:v,setRowCollapse:x,parentPath:w,fieldTypes:g,permissions:R,hasMaxRows:D,fieldSchema:[...s.fields]}):null})),(i.length<_||I&&0===i.length)&&a.createElement(h.Z,{type:"error"},"This field requires at least"," ",`${_||1} ${1===_||void 0===_?d.singular:d.plural}`),0===i.length&&T&&a.createElement(h.Z,null,"This field has no"," ",d.plural,"."),e.placeholder))),!T&&(i.length<Z||void 0===Z)&&a.createElement("div",{className:`${E}__add-button-wrap`},a.createElement(b.Z,{buttonType:"custom",size:"large",horizontalAlign:"left",button:a.createElement(n.Z,{buttonStyle:"icon-label",icon:"plus",iconPosition:"left",iconStyle:"with-border"},`Add ${d.singular}`),render:({close:e})=>a.createElement(f.Z,{blocks:C,addRow:c,addRowIndex:k,close:e})}))))})),k=(0,r.Z)((e=>{const{label:l,name:o,path:t,blocks:r,labels:n=g,fieldTypes:u,maxRows:m,minRows:b,required:f,validate:h=w.blocks,permissions:y,admin:{readOnly:E,description:k,condition:x}}=e,C=t||o,{preferencesKey:T}=(0,d.x5)(),{getPreference:_,setPreference:Z}=(0,s.G)(),[I,O]=(0,a.useReducer)(i.Z,[]),D=(0,c.cI)(),{dispatchFields:P}=D,S=(0,a.useCallback)((e=>h(e,{minRows:b,maxRows:m,labels:n,blocks:r,required:f})),[h,m,b,n,r,f]),[$,M]=(0,a.useState)(!1),{showError:A,errorMessage:F,value:q,setValue:V}=(0,v.Z)({path:C,validate:S,disableFormData:$,ignoreWhileFlattening:!0,condition:x}),K=(0,a.useCallback)((async(e,l)=>{const o=r.find((e=>e.slug===l)),a=await(0,p.Z)(o.fields);P({type:"ADD_ROW",rowIndex:e,subFieldState:a,path:C,blockType:l}),O({type:"ADD",rowIndex:e,blockType:l}),V(q+1)}),[C,V,q,r,P]),L=(0,a.useCallback)((e=>{O({type:"REMOVE",rowIndex:e}),P({type:"REMOVE_ROW",rowIndex:e,path:C}),V(q-1)}),[C,V,q,P]),N=(0,a.useCallback)(((e,l)=>{O({type:"MOVE",moveFromIndex:e,moveToIndex:l}),P({type:"MOVE_ROW",moveFromIndex:e,moveToIndex:l,path:C})}),[O,P,C]),W=(0,a.useCallback)((async(e,l)=>{var o,a,t;if(O({type:"SET_COLLAPSE",id:e,collapsed:l}),T){const s=await _(T)||{fields:{}};let r=(null===(a=null===(o=null==s?void 0:s.fields)||void 0===o?void 0:o[C])||void 0===a?void 0:a.collapsed.filter((e=>I.find((l=>l.id===e)))))||[];l?r.push(e):r=r.filter((l=>l!==e)),Z(T,{...s,fields:{...(null==s?void 0:s.fields)||{},[C]:{...null===(t=null==s?void 0:s.fields)||void 0===t?void 0:t[C],collapsed:r}}})}}),[T,_,C,Z,I]),B=(0,a.useCallback)((e=>{if(!e.destination)return;const l=e.source.index,o=e.destination.index;N(l,o)}),[N]);return(0,a.useEffect)((()=>{(async()=>{var e,l;const o=T?await _(T):void 0,a=D.getDataByPath(C);O({type:"SET_ALL",data:a||[],collapsedState:null===(l=null===(e=null==o?void 0:o.fields)||void 0===e?void 0:e[C])||void 0===l?void 0:l.collapsed})})()}),[D,C,T,_]),(0,a.useEffect)((()=>{V((null==I?void 0:I.length)||0),0===(null==I?void 0:I.length)?M(!1):M(!0)}),[I,V]),a.createElement(R,{onDragEnd:B,label:l,showError:A,errorMessage:F,rows:I,labels:n,addRow:K,removeRow:L,moveRow:N,path:C,name:o,fieldTypes:u,setCollapse:W,permissions:y,value:q,blocks:r,readOnly:E,minRows:b,maxRows:m,required:f,description:k})}))},5074:(e,l,o)=>{o.d(l,{a4:()=>s,x5:()=>r});var a=o(7294);const t=(0,a.createContext)({}),s=e=>{const{children:l,type:o,slug:s}=e;if("global"===o)return a.createElement(t.Provider,{value:{type:o,slug:e.slug,preferencesKey:`global-${s}`}},l);if("collection"===o){const{id:r}=e,n={type:o,slug:s};return r&&(n.id=r,n.preferencesKey=`collection-${s}-${r}`),a.createElement(t.Provider,{value:n},l)}return null},r=()=>(0,a.useContext)(t)}}]);